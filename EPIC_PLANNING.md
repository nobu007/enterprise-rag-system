# エピック駆動開発計画書 (Epic-Driven Planning)

本ドキュメントは、プロジェクトの主要な開発項目をエピック、ユーザーストーリー、タスクに分解し、受け入れ基準と優先順位を定義したものです。

---

## 📅 計画概要

| Epic ID | エピック名 | 優先度 | 見積もり (Story Points/Hours) | ターゲット |
| :--- | :--- | :--- | :--- | :--- |
| **E-01** | **技術基盤の適正化 (Foundation Refactoring)** | **Highest** | **25h** | Week 0 |
| **E-02** | **検索・RAG精度の高度化 (Advanced RAG Core)** | **High** | **160h** | Week 1-4 |
| **E-03** | **エンタープライズ管理機能 (Enterprise Features)** | Medium | 90h | Week 4-6 |
| **E-04** | **プロダクション・スケーラビリティ (Scalability)** | Medium | 70h | Week 7-9 |

---

## 🧩 詳細定義

### Epic 1: 技術基盤の適正化 (Foundation Refactoring)
**目的:** 技術的負債を解消し、テスト容易性、可観測性、セキュリティを向上させることで、今後の機能開発を加速させる。

#### Story 1.1: テスト自動化基盤の構築
*   **As a** 開発者
*   **I want** 単体テストと結合テストをCIで自動実行できる環境が欲しい
*   **So that** リグレッションを防ぎながら安心して機能追加ができるようにするため

*   **Acceptance Criteria (受け入れ基準):**
    *   [ ] `pytest` によるテスト実行が設定されていること
    *   [ ] CIパイプライン (GitHub Actions) でテストがパスすること
    *   [ ] 主要なサービス (`rag_pipeline`, `retrieval`) のカバレッジが向上していること
*   **見積もり:** 8h
*   **優先度:** Immediate

#### Story 1.2: 非同期処理 (AsyncIO) への移行
*   **As a** システム利用者
*   **I want** APIが高い同時実行性能を持っていること
*   **So that** 複数のユーザーが同時に質問しても待たされないようにするため

*   **Acceptance Criteria:**
    *   [ ] `openai` クライアントが `AsyncOpenAI` に置換されていること
    *   [ ] APIエンドポイントが全て `async def` で実装されていること
    *   [ ] イベントループをブロックする同期処理が排除されていること
*   **見積もり:** 6h
*   **優先度:** High

#### Story 1.3: 構造化ロギングと構成管理
*   **As a** 運用担当者
*   **I want** ログがJSON形式で出力され、設定が環境変数で管理されていること
*   **So that** 本番環境での監視や設定変更を容易にするため

*   **Acceptance Criteria:**
    *   [ ] `print()` 文が廃止され、ロガー経由で出力されていること
    *   [ ] ログにリクエストIDが含まれていること
    *   [ ] 全てのハードコードされた設定値が `config.py` または環境変数から読み込まれること
*   **見積もり:** 7h
*   **優先度:** High

---

### Epic 2: 検索・RAG精度の高度化 (Advanced RAG Core)
**目的:** ドキュメントの理解度と検索精度を高め、ユーザーの質問に対して正確で信頼性の高い回答を生成する。

#### Story 2.1: 高度なドキュメント取り込み (Ingestion)
*   **As a** ナレッジ管理者
*   **I want** PDFやOffice文書を表や画像を含めて正確に取り込めること
*   **So that** 形式を問わず社内ドキュメントを知識ベースとして活用できるため

*   **Acceptance Criteria:**
    *   [ ] Unstructured.io を用いてPDF, DOCX, PPTXが解析できること
    *   [ ] ドキュメント内の表(Table)が崩れずに抽出されること
    *   [ ] セマンティックチャンキングにより、文脈の切れ目で分割されること
*   **見積もり:** 40h
*   **優先度:** High

#### Story 2.2: ハイブリッド検索エンジンの実装
*   **As a** ユーザー
*   **I want** キーワード検索と意味検索を組み合わせた結果が得られること
*   **So that** 専門用語も一般的な質問も漏らさず検索できるため

*   **Acceptance Criteria:**
    *   [ ] BM25 (キーワード検索) と Vector Search (意味検索) が併用されていること
    *   [ ] Reciprocal Rank Fusion (RRF) で結果が統合されていること
    *   [ ] 評価指標として MRR@10 > 0.75 を達成すること
    *   [ ] 検索完了までのレイテンシが平均2秒以内であること (生産性向上)
*   **見積もり:** 60h
*   **優先度:** High

#### Story 2.3: Re-rankingと回答生成の最適化
*   **As a** ユーザー
*   **I want** 検索結果の上位に最も関連する情報が並び、それに基づいた的確な回答が得られること
*   **So that** 誤った情報（ハルシネーション）に基づいた回答を避けるため

*   **Acceptance Criteria:**
    *   [ ] Cross-encoder等を用いたRe-ranking処理が実装されていること
    *   [ ] 回答のソース（引用元）が明示されること
    *   [ ] Faithfulnessスコアが 0.95 以上であること
*   **見積もり:** 60h
*   **優先度:** High

---

### Epic 3: エンタープライズ管理機能 (Enterprise Features)
**目的:** 企業導入に必要なセキュリティ、管理、コンプライアンス要件を満たす。

#### Story 3.1: 認証・認可システム (AuthN/AuthZ)
*   **As a** セキュリティ管理者
*   **I want** ユーザーの役割に応じてアクセス権限を制御できること
*   **So that** 機密情報が権限のないユーザーに漏洩するのを防ぐため

*   **Acceptance Criteria:**
    *   [ ] OAuth 2.0 / OIDC によるログインが可能であること
    *   [ ] ユーザーロール (Admin, User) に基づくRBACが機能していること
*   **見積もり:** 40h
*   **優先度:** Medium

#### Story 3.2: マルチテナンシー対応
*   **As a** サービス管理者
*   **I want** 複数の組織や部署のデータを論理的に分離できること
*   **So that** 部署間のデータ混在を防ぎながら単一システムで運用するため

*   **Acceptance Criteria:**
    *   [ ] テナントIDごとにVector Storeの名前空間が分離されていること
    *   [ ] ユーザーが所属テナントのデータのみを検索できること
*   **見積もり:** 30h
*   **優先度:** Medium

---

### Epic 4: プロダクション・スケーラビリティ (Scalability)
**目的:** ユーザー数やデータ量が増加しても安定したパフォーマンスを維持する。

#### Story 4.1: 非同期タスクキューの実装
*   **As a** ユーザー
*   **I want** 大量のドキュメントアップロード時もUIがフリーズしないこと
*   **So that** バックグラウンドで処理が進む間も別の作業ができるため

*   **Acceptance Criteria:**
    *   [ ] Celery + Redis によるタスクキューが導入されていること
    *   [ ] ドキュメント処理のステータスが確認できること
*   **見積もり:** 30h
*   **優先度:** Medium

#### Story 4.2: キャッシング戦略
*   **As a** ユーザー
*   **I want** 同じ質問に対しては即座に回答が返ってくること
*   **So that** 頻出する質問に対する応答時間を短縮し、APIコストを削減するため

*   **Acceptance Criteria:**
    *   [ ] 類似クエリの結果がRedisにキャッシュされていること
    *   [ ] キャッシュヒット時のレイテンシが 0.5秒以下であること
    *   [ ] キャッシュヒット率 30%以上を達成すること (APIコスト削減)
*   **見積もり:** 20h
*   **優先度:** Low

---

## 📈 スプリント計画 (初期フェーズ)

### Sprint 1 (Week 0): Foundation
*   **Goal:** 開発環境の健全化と技術的負債の解消
*   **Stories:**
    *   Story 1.1: テスト自動化基盤
    *   Story 1.2: 非同期処理移行
    *   Story 1.3: 構造化ロギング

### Sprint 2 (Week 1-2): Ingestion & Search
*   **Goal:** あらゆるドキュメントを取り込み、検索可能にする
*   **Stories:**
    *   Story 2.1: 高度なドキュメント取り込み
    *   Story 2.2: ハイブリッド検索エンジンの実装 (前半)

### Sprint 3 (Week 3-4): Generation & Quality
*   **Goal:** 回答品質の向上とRAGパイプラインの完成
*   **Stories:**
    *   Story 2.2: ハイブリッド検索エンジンの実装 (後半)
    *   Story 2.3: Re-rankingと回答生成の最適化
